<!DOCTYPE html>
<html lang="ko" style="align-items: center">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Blaubit Version Management</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div style="text-align: center">
    <br />
    <br />
<img src="https://github.com/ChoHyunGook/pubpic/blob/main/new_blaubit.png?raw=true"
     width="350" height="120">
    <br />
<h1>Version Management</h1>
<h3>|| 접속부서 : <%= data.department %> || 접속한 시간 : <%= data.date %> ||</h3>
    <h3>|| 접속한 아이디 : <%= data.access_id %> || 접속한 담당자 : <%= data.access_name %> || </h3>
    <br />
    <div id="serverData" style="display: none"><%= JSON.stringify(serverData) %></div>
    <div id="appData" style="display: none"><%= JSON.stringify(appData) %></div>
    <div id="deviceData" style="display: none"><%= JSON.stringify(deviceData) %></div>
    <div id="loginData" style="display: none"><%= JSON.stringify(data) %></div>
    <div class="outset">
    <form
                action="http://socket.doorbellsquare.com:8080/uploadS3File"
                method="post" enctype="multipart/form-data"
        >
        <h3> 버전 파일 업로드</h3>
        <input type="hidden" name="data" value="<%= JSON.stringify(data) %>">
        <input type="file" name="file" id="file">
            <button type="submit" class="custom-btn btn-12">
                <span> Upload !</span>
                <span> 파일 업로드 </span>
            </button>

        </form>
    </div>
<br/>
    <div class="outset">
        <form
                action="http://socket.doorbellsquare.com:8080/department/version/download"
                method="post"
                enctype="application/x-www-form-urlencoded"
        >
            <h3> 버전 별 다운로드</h3>

            <% if (data.department === 'Server' || data.department === 'CEO') { %>
                <select name='allCheck' id="select_department" onchange="changeCheckBox(this)">
                    <option value="none" selected>선택</option>
                    <option name="Server" value="Server">Server</option>
                    <option name="Device" value="Device">Device</option>
                    <option name="App" value="App">App</option>
                </select>

                <select name="devSelect" id="devSelect" onchange="devCheck(this)">
                    <option> 개발 선택 </option>
                </select>

                <select name="versionSelect" id="versionSelect">
                    <option> 버전 선택 </option>
                </select>


                <button type="submit" class="custom-btn btn-12">
                    <span> Download !</span>
                    <span> 다운로드 </span>
                </button>

            <% } %>

            <% if (data.department === 'App') { %>
                <select name='allCheck' id="select_department" onchange="changeCheckBox(this)">
                    <option value="none" selected>선택</option>
                    <option name="App" value="App">App</option>
                </select>

                <select name="devSelect" id="devSelect" onchange="devCheck(this)">
                    <option> 개발 선택 </option>
                </select>

                <select name="versionSelect" id="versionSelect">
                    <option> 버전 선택 </option>
                </select>

                <button type="submit" class="custom-btn btn-12">
                    <span> Download !</span>
                    <span> 다운로드 </span>
                </button>

            <% } %>

            <% if (data.department === 'Device') { %>
                <select name='allCheck' id="select_department" onchange="changeCheckBox(this)">
                    <option value="none" selected>선택</option>
                    <option name="Device" value="Device">Device</option>
                </select>

                <select name="devSelect" id="devSelect" onchange="devCheck(this)">
                    <option> 개발 선택 </option>
                </select>

                <select name="versionSelect" id="versionSelect">
                    <option> 버전 선택 </option>
                </select>

                <button type="submit" class="custom-btn btn-12">
                    <span> Download !</span>
                    <span> 다운로드 </span>
                </button>
            <% } %>
        </form>
    </div>

</div>
</body>
<script>

    let devSelect
    let allCheck

    function changeCheckBox(e){
        const select = e.value
        let serverSelect = ['=== 선택 ===','apiServer','doorbellAdmin','doorbellGo','lambda','sleepcore','fastStroke']
        let deviceSelect = ['=== 선택 ===','bldb','bldc','blwc','blvc','blsi']
        let appSelect = ['=== 선택 ===','doorbellApp','sleepcoreApp','fastStrokeApp']

        var target =document.getElementById('devSelect')
        if(select === 'Server') var contents = serverSelect
        else if(select === 'Device') var contents = deviceSelect
        else if(select === 'App') var contents = appSelect
        target.options.length = 0;
        for(x in contents){
            var opt = document.createElement("option");
            opt.value = contents[x];
            opt.name = contents[x]
            opt.innerHTML = contents[x];
            target.appendChild(opt);
        }

        allCheck = select

    }

    function devCheck(e){
        const select = e.value
        const serverData = JSON.parse(document.getElementById('serverData').innerHTML)
        const appData = JSON.parse(document.getElementById('appData').innerHTML)
        const deviceData = JSON.parse(document.getElementById('deviceData').innerHTML);

        let contents =[]

        var target =document.getElementById('versionSelect')
        if(allCheck === 'Server'){
            serverData.map(e=>{
                if(e.key.split('/')[1] === select){
                    if(e.key.split('/')[2].length === 0){
                        contents.push('=== 선택 ===')
                    }else{
                        contents.push(e.key.split('/')[2])
                    }
                }
            })
        }else if(allCheck === 'Device'){
            deviceData.map(e=>{
                if(e.key.split('/')[1] === select){
                    if(e.key.split('/')[2].length === 0){
                        contents.push('=== 선택 ===')
                    }else{
                        contents.push(e.key.split('/')[2])
                    }
                }
            })
        } else if(allCheck === 'App'){
            appData.map(e=>{
                if(e.key.split('/')[1] === select){
                    if(e.key.split('/')[2].length === 0){
                        contents.push('=== 선택 ===')
                    }else{
                        contents.push(e.key.split('/')[2])
                    }
                }
            })

        }

        target.options.length = 0;
        contents = [contents[contents.length -1],...contents]
        contents.pop()

        for(x in contents){
            var opt = document.createElement("option");
            opt.value = contents[x];
            opt.name = contents[x]
            opt.innerHTML = contents[x];
            target.appendChild(opt);
        }

    }


</script>
</html>